<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>EagleEye</title>
<!-- 	<link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css"> -->

    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.css">
    <link rel="stylesheet" href="iconfont/iconfont.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="page">
  <header class="bar bar-nav topbar">
    <a class="icon iconfont pull-left icon-back" href="#"></a>
    <h1 class="title">审计</h1>
    <a class="icon iconfont pull-right icon-search" href="#"></a>
  </header>
<div class="bar bar-header-secondary s-bar-audit">
  22/107(20%)
</div>

  <nav class="bar bar-tab">
    <a class="tab-item" href="#">
      <i class="icon iconfont icon-home"></i>
      <span class="tab-label">首页</span>
    </a>
    <a class="tab-item active" href="#">
      <i class="icon iconfont icon-writefill"></i>
      <span class="tab-label">审计</span>
    </a>
    <a class="tab-item" href="#">
      <i class="icon iconfont icon-shezhi2"></i>
      <span class="tab-label">设置</span>
    </a>
    <a class="tab-item" href="#">
      <i class="icon iconfont icon-people"></i>
      <span class="tab-label">个人</span>
    </a>
  </nav>
  <div class="content">
    <section class="audit-section">
      <div class="audit-title">1.0 第一部分 | 2/2 (100%) <a href="javascript:;" class="iconfont icon-unfold pull-right"></a></div>
      <ul>
        <li>
          <p>1.1 Has the last inspenction been reviewed?</p>
          <div class="row">
            <div class="col-33">
              <a href="#" class="button button-fill btn-yes">YES</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-no">NO</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-na">N/A</a>
            </div>
          </div>
          <div class="upload-img" hidden>
            <input type="text" class="file-input" placeholder="填写备注..">
            <div class="row pic-row">

              <div class="col-25">
                <div class="add-pic">
                  <i class="iconfont icon-camerafill"></i>
                </div>
                <a class="del-pic"><i class="iconfont icon-close"></i></a>
                <input type="file" class="file" accept="image/*">
              </div>

            </div>
          </div>
        </li>
        <li>
          <p>1.1 Has the last inspenction been reviewed?</p>
          <div class="row">
            <div class="col-33">
              <a href="#" class="button button-fill btn-yes">YES</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-no">NO</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-na">N/A</a>
            </div>
          </div>
          <div class="upload-img" hidden>
            <input type="text" class="file-input" placeholder="填写备注..">
            <div class="row pic-row">

              <div class="col-25">
                <div class="add-pic">
                  <i class="iconfont icon-camerafill"></i>
                </div>
                <a class="del-pic"><i class="iconfont icon-close"></i></a>
                <input type="file" class="file" accept="image/*">
              </div>

            </div>
          </div>
        </li>
      </ul>
    </section>
    <section class="audit-section">
      <div class="audit-title">1.0 第二部分 | 2/2 (100%) <a href="javascript:;" class="iconfont icon-fold pull-right"></a></div>
      <ul style="display:none;">
        <li>
          <p>1.1 Has the last inspenction been reviewed?</p>
          <div class="row">
            <div class="col-33">
              <a href="#" class="button button-fill btn-yes">YES</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-no">NO</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-na">N/A</a>
            </div>
          </div>
          <div class="upload-img" hidden>
            <input type="text" class="file-input" placeholder="填写备注..">
            <div class="row pic-row">

              <div class="col-25">
                <div class="add-pic">
                  <i class="iconfont icon-camerafill"></i>
                </div>
                <a class="del-pic"><i class="iconfont icon-close"></i></a>
                <input type="file" class="file" accept="image/*">
              </div>

            </div>
          </div>
        </li>
        <li>
          <p>1.1 Has the last inspenction been reviewed?</p>
          <div class="row">
            <div class="col-33">
              <a href="#" class="button button-fill btn-yes">YES</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-no">NO</a>
            </div>
            <div class="col-33">
              <a href="#" class="button button-fill btn-na">N/A</a>
            </div>
          </div>
          <div class="upload-img" hidden>
            <input type="text" class="file-input" placeholder="填写备注..">
            <div class="row pic-row">

              <div class="col-25">
                <div class="add-pic">
                  <i class="iconfont icon-camerafill"></i>
                </div>
                <a class="del-pic"><i class="iconfont icon-close"></i></a>
                <input type="file" class="file" accept="image/*">
              </div>

            </div>
          </div>
        </li>
      </ul>
    </section>
  </div>
</div>
<script src="//g.alicdn.com/sj/lib/zepto/zepto.min.js" charset="utf-8"></script>
<script src="//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js" charset="utf-8"></script>
<script src="//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js" charset="utf-8"></script>
<script>
  var audit = {
    init: function(){
      this.bindEvent();
    },
    bindEvent: function(){
      var self = this;
      $(document).on('click', '.audit-title', function(e){
        self.handleSection(e);
      }).on('click', '.audit-section .button', function(e){
        self.handleImgArea(e);
      }).on('click', '.del-pic', function(e){
        self.delPic(e);
      }).on('change', '.file', function(e){
        self.changeFile(e);
      });
    },
    handleSection: function(e){
      var $this = $(e.currentTarget);
      var $content = $this.next('ul');

      if(!this._visible($content)){
        $this.find('.icon-fold').removeClass('icon-fold').addClass('icon-unfold');
        $this.next('ul').show();
      } else{
        $this.find('.icon-unfold').removeClass('icon-unfold').addClass('icon-fold');
        $this.next('ul').hide();
      }
    },
    handleImgArea: function(e){
      var $this = $(e.currentTarget);
      if($this.hasClass('active')){
        return;
      }

      var $upload = $this.parents('.row').next('.upload-img');
      $this.parents('.row').find('.button').removeClass('active');
      $this.addClass('active');
      if($this.hasClass('btn-yes')){
        $upload.hide();
      } else{
        $upload.show();
      }
    },
    delPic: function(e){
      var $this = $(e.currentTarget),
        $img = $this.prev('.add-pic').find('img'),
        $camera = $this.prev('.add-pic').find('.iconfont'),
        $file = $this.next('input');
      if($this.parents('.row').find('.col-25').length > 1){
        $this.parents('.col-25').remove();
      } else{
        $file.val('').prop('disabled', false);
        $camera.show();
        $img.remove();
        $this.hide();
      }
    },
    changeFile: function(e){
      var self = this;
      var file = e.currentTarget.files[0];
      var $this = $(e.currentTarget);
      var val = $this.val();
      var $target = $this.parents('.col-25').find('.add-pic');
      if(!/image\/\w+/.test(file.type)){
        alert("请确保文件为图像类型");
        return false;
      }
      var reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = function(e){
        $('<img width="100%" height="100%" src="' + this.result + '" alt=""/>').appendTo($target);
        $target.find('.iconfont').hide();
        $target.next('.del-pic').show();
        $this.prop('disabled', true);
      }
      if(val != '' && $this.parents('.row').find('.col-25').length < 4){
        self._addFileInput($this.parents('.row'));
      }
    },

    _addFileInput: function($el){
      $el.append('<div class="col-25"><div class="add-pic"><i class="iconfont icon-camerafill"></i></div><a class="del-pic"><i class="iconfont icon-close"></i></a><input type="file" class="file" accept="image/*"></div>');
    },
    _visible: function(elem){
      return !!(elem.width() || elem.height()) && elem.css("display") !== "none";
    }
  }
  audit.init();
</script>
</body>
</html>